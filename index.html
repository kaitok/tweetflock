<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <title>twitter</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
  <script>
  $(function() {

    var socket = io.connect();
    $('form').submit(function() {
      socket.emit('msg', $('input').val());
      return false;
    });

    socket.on('data', function(data) {
      console.log(data);
      if(data.geo !== null && data.geo['coordinates'] != null){
        $('#tweet').prepend('<a href="http://twitter.com/'+ data.user['screen_name'] + '" target="_blank">' + '<img src="' + data.user['profile_image_url'] + '" target="_blank">' + '</a>' + data.user['name'] + '</br>' + data.text + '</br>' + data.source + '</br>' + 'geo:' + data.geo['coordinates'] + '</br>');

        var geo = data.geo['coordinates'];
        var latitude = geo[0];//緯度
        var longitude = geo[1];//経度
        setMapping(latitude,longitude);
      }

      // $('div').prepend('<a href="http://twitter.com/'+ data.user['screen_name'] +'">'+'<img src="' + data.user['profile_image_url'] + '" target="_blank">' + '</a>');
      //createMap(data.geo['coordinates']);
    });
    $('#stop').click(function(){
      socket.emit('stop', $('input').val());
      return false;
    })
  });

var map;
function initialize() {
  var myLatlng = new google.maps.LatLng('35.6582', '139.7456');
  var myOptions = {
    zoom: 3,
    center: myLatlng,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }
  map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
}

function setMapping(latitude,longitude) {
  var myLatlng = new google.maps.LatLng(latitude,longitude);//経度,緯度
  var marker = new google.maps.Marker({
    position:myLatlng
  });
  marker.setMap(map);
}

</script>
<style type="text/css">
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}

#map_canvas {
  height: 400px;
  width: 100%;
}
</style>
<body onload="initialize()">
  <form method="post">
    <input type="text" name="keyword"/>
    <input type="submit" value="search"/>
    <input type="button" id="stop" value="stop">
  </form>
  <div id="map_canvas"></div>
  <div id="tweet"></div>
</body>
</html>